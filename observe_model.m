function [Z,H]= observe_model(X, idf)
%function [z,H]= observe_model(x, idf)
%
% INPUTS:
%   x - state vector
%   idf - index of feature order in state
%
% OUTPUTS:
%   z - predicted observation
%   H - observation Jacobian
%
% Given a feature index (ie, the order of the feature in the state vector),
% predict the expected range-bearing observation of this feature and its Jacobian.
%
% Tim Bailey 2004.

Nxv= 13; % number of vehicle pose states
fpos= Nxv + idf*3 - 2; % position of xf in state
H= zeros(3, length(X));

% auxiliary values
% dx= x(fpos)  -x(1); 
% dy= x(fpos+1)-x(2);
% dz= x(fpos+2)-x(3);
x=X(1);
y=X(2);
z=X(3);

q1=X(4);
q2=X(5);
q3=X(6);
q4=X(7);

xf = X(fpos);
yf = X(fpos+1);
zf = X(fpos+2);

% qsum = x(4)^2+x(5)^2+x(6)^2+x(7)^2;
% qmod = sqrt(qsum);
% d2= dx^2 + dy^2 + dz^2;
% d= sqrt(d2);
% xd= dx/d;
% yd= dy/d;
% zd= dz/d;
% xd2= dx/d2;
% yd2= dy/d2;
% zd2= dz/d2;

% predict z

dx= x-xf;
dy= y-yf;
dz= z-zf;
Rho = sqrt(dx^2 + dy^2 + dz^2); 

DCM = quat2dcm([X(4) -X(5) -X(6) -X(7)]);
Z=zeros(3,length(xf));
for i =1:length(xf)
cfc = DCM*[dx(i);dy(i);dz(i)];
Z(:,i)= [pi_to_pi(atan2(cfc(2),cfc(1)));
            pi_to_pi(atan2(cfc(3),sqrt(cfc(1)^2+cfc(2)^2)));
            Rho(i)];
end
% calculate H

H(:,1:13) = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               -((q1^2 + q2^2 + q3^2 + q4^2)*(q1^2*conj(y) - q2^2*conj(y) - q3^2*conj(y) + q4^2*conj(y) - q1^2*conj(yf) + q2^2*conj(yf) + q3^2*conj(yf) - q4^2*conj(yf) - 2*q1*q2*conj(z) - 2*q3*q4*conj(z) + 2*q1*q2*conj(zf) + 2*q3*q4*conj(zf)))/(((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + 1)*(q1^2*conj(x) + q2^2*conj(x) - q3^2*conj(x) - q4^2*conj(x) - q1^2*conj(xf) - q2^2*conj(xf) + q3^2*conj(xf) + q4^2*conj(xf) - 2*q1*q4*conj(y) + 2*q2*q3*conj(y) + 2*q1*q4*conj(yf) - 2*q2*q3*conj(yf) + 2*q1*q3*conj(z) + 2*q2*q4*conj(z) - 2*q1*q3*conj(zf) - 2*q2*q4*conj(zf))^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ((q1^2 + q2^2 + q3^2 + q4^2)*(q1^2*conj(x) - q2^2*conj(x) - q3^2*conj(x) + q4^2*conj(x) - q1^2*conj(xf) + q2^2*conj(xf) + q3^2*conj(xf) - q4^2*conj(xf) + 2*q1*q3*conj(z) - 2*q2*q4*conj(z) - 2*q1*q3*conj(zf) + 2*q2*q4*conj(zf)))/(((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + 1)*(q1^2*conj(x) + q2^2*conj(x) - q3^2*conj(x) - q4^2*conj(x) - q1^2*conj(xf) - q2^2*conj(xf) + q3^2*conj(xf) + q4^2*conj(xf) - 2*q1*q4*conj(y) + 2*q2*q3*conj(y) + 2*q1*q4*conj(yf) - 2*q2*q3*conj(yf) + 2*q1*q3*conj(z) + 2*q2*q4*conj(z) - 2*q1*q3*conj(zf) - 2*q2*q4*conj(zf))^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           -(2*(q1^2 + q2^2 + q3^2 + q4^2)*(q1*q2*conj(x) + q3*q4*conj(x) - q1*q2*conj(xf) - q3*q4*conj(xf) + q1*q3*conj(y) - q2*q4*conj(y) - q1*q3*conj(yf) + q2*q4*conj(yf)))/(((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + 1)*(q1^2*conj(x) + q2^2*conj(x) - q3^2*conj(x) - q4^2*conj(x) - q1^2*conj(xf) - q2^2*conj(xf) + q3^2*conj(xf) + q4^2*conj(xf) - 2*q1*q4*conj(y) + 2*q2*q3*conj(y) + 2*q1*q4*conj(yf) - 2*q2*q3*conj(yf) + 2*q1*q3*conj(z) + 2*q2*q4*conj(z) - 2*q1*q3*conj(zf) - 2*q2*q4*conj(zf))^2),                                                        (((2*(conj(x) - conj(xf))*(- q1^2*q4 - 2*q1*q2*q3 + q2^2*q4 + q3^2*q4 + q4^3))/(q1^2 + q2^2 + q3^2 + q4^2)^2 - (2*(conj(z) - conj(zf))*(- q1^2*q2 + 2*q1*q3*q4 + q2^3 + q2*q3^2 + q2*q4^2))/(q1^2 + q2^2 + q3^2 + q4^2)^2 + (4*q1*(q2^2 + q4^2)*(conj(y) - conj(yf)))/(q1^2 + q2^2 + q3^2 + q4^2)^2)/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2)) - ((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))*((2*(conj(z) - conj(zf))*(- q1^2*q3 - 2*q1*q2*q4 + q2^2*q3 + q3^3 + q3*q4^2))/(q1^2 + q2^2 + q3^2 + q4^2)^2 - (2*(conj(y) - conj(yf))*(- q1^2*q4 + 2*q1*q2*q3 + q2^2*q4 + q3^2*q4 + q4^3))/(q1^2 + q2^2 + q3^2 + q4^2)^2 + (4*q1*(q3^2 + q4^2)*(conj(x) - conj(xf)))/(q1^2 + q2^2 + q3^2 + q4^2)^2))/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)/((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + 1),                                                              -(((2*(conj(z) - conj(zf))*(q1^3 - q1*q2^2 + q1*q3^2 + q1*q4^2 + 2*q2*q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)^2 - (2*(conj(x) - conj(xf))*(q1^2*q3 - 2*q1*q2*q4 - q2^2*q3 + q3^3 + q3*q4^2))/(q1^2 + q2^2 + q3^2 + q4^2)^2 + (4*q2*(q1^2 + q3^2)*(conj(y) - conj(yf)))/(q1^2 + q2^2 + q3^2 + q4^2)^2)/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2)) + ((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))*((2*(conj(y) - conj(yf))*(q1^2*q3 + 2*q1*q2*q4 - q2^2*q3 + q3^3 + q3*q4^2))/(q1^2 + q2^2 + q3^2 + q4^2)^2 + (2*(conj(z) - conj(zf))*(q1^2*q4 - 2*q1*q2*q3 - q2^2*q4 + q3^2*q4 + q4^3))/(q1^2 + q2^2 + q3^2 + q4^2)^2 + (4*q2*(q3^2 + q4^2)*(conj(x) - conj(xf)))/(q1^2 + q2^2 + q3^2 + q4^2)^2))/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)/((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + 1),                                                                (((2*(conj(x) - conj(xf))*(q1^2*q2 - 2*q1*q3*q4 + q2^3 - q2*q3^2 + q2*q4^2))/(q1^2 + q2^2 + q3^2 + q4^2)^2 + (2*(conj(z) - conj(zf))*(q1^2*q4 + 2*q1*q2*q3 + q2^2*q4 - q3^2*q4 + q4^3))/(q1^2 + q2^2 + q3^2 + q4^2)^2 + (4*q3*(q2^2 + q4^2)*(conj(y) - conj(yf)))/(q1^2 + q2^2 + q3^2 + q4^2)^2)/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2)) - ((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))*((2*(conj(y) - conj(yf))*(q1^2*q2 + 2*q1*q3*q4 + q2^3 - q2*q3^2 + q2*q4^2))/(q1^2 + q2^2 + q3^2 + q4^2)^2 + (2*(conj(z) - conj(zf))*(q1^3 + q1*q2^2 - q1*q3^2 + q1*q4^2 - 2*q2*q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)^2 - (4*q3*(q1^2 + q2^2)*(conj(x) - conj(xf)))/(q1^2 + q2^2 + q3^2 + q4^2)^2))/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)/((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + 1),                                                               (((2*(conj(x) - conj(xf))*(q1^3 + q1*q2^2 + q1*q3^2 - q1*q4^2 - 2*q2*q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)^2 + (2*(conj(z) - conj(zf))*(q1^2*q3 + 2*q1*q2*q4 + q2^2*q3 + q3^3 - q3*q4^2))/(q1^2 + q2^2 + q3^2 + q4^2)^2 - (4*q4*(q1^2 + q3^2)*(conj(y) - conj(yf)))/(q1^2 + q2^2 + q3^2 + q4^2)^2)/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2)) + ((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))*((2*(conj(y) - conj(yf))*(q1^3 + q1*q2^2 + q1*q3^2 - q1*q4^2 + 2*q2*q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)^2 - (2*(conj(z) - conj(zf))*(q1^2*q2 - 2*q1*q3*q4 + q2^3 + q2*q3^2 - q2*q4^2))/(q1^2 + q2^2 + q3^2 + q4^2)^2 + (4*q4*(q1^2 + q2^2)*(conj(x) - conj(xf)))/(q1^2 + q2^2 + q3^2 + q4^2)^2))/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)/((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + 1), 0, 0, 0, 0, 0, 0;
                    -((((4*(q1*q4 + q2*q3)*(((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2))*(((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(2*((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(3/2)) + (2*(q1*q3 - q2*q4))/(((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(1/2)*(q1^2 + q2^2 + q3^2 + q4^2)))/((((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2) + 1), ((((4*(q1*q4 - q2*q3)*(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2))*(((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(2*((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(3/2)) + (2*(q1*q2 + q3*q4))/(((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(1/2)*(q1^2 + q2^2 + q3^2 + q4^2)))/((((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2) + 1), -((((4*(q1*q3 + q2*q4)*(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(q1^2 + q2^2 + q3^2 + q4^2) - (4*(q1*q2 - q3*q4)*(((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(q1^2 + q2^2 + q3^2 + q4^2))*(((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(2*((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(3/2)) - (q1^2 - q2^2 - q3^2 + q4^2)/(((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(1/2)*(q1^2 + q2^2 + q3^2 + q4^2)))/((((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2) + 1), -(2*(conj(x)^2 - 2*conj(y)*conj(yf) - 2*conj(z)*conj(zf) - 2*conj(x)*conj(xf) + conj(xf)^2 + conj(y)^2 + conj(yf)^2 + conj(z)^2 + conj(zf)^2)*(q3^3*conj(x) - q3^3*conj(xf) - q2^3*conj(y) + q2^3*conj(yf) - q1^2*q3*conj(x) + q2^2*q3*conj(x) + q3*q4^2*conj(x) + q1^2*q3*conj(xf) - q2^2*q3*conj(xf) - q3*q4^2*conj(xf) + q1^2*q2*conj(y) - q2*q3^2*conj(y) - q2*q4^2*conj(y) - q1^2*q2*conj(yf) + q2*q3^2*conj(yf) + q2*q4^2*conj(yf) - 2*q1*q2^2*conj(z) - 2*q1*q3^2*conj(z) + 2*q1*q2^2*conj(zf) + 2*q1*q3^2*conj(zf) + 2*q1*q2*q4*conj(x) - 2*q1*q2*q4*conj(xf) + 2*q1*q3*q4*conj(y) - 2*q1*q3*q4*conj(yf)))/(((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(3/2)*((((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2) + 1)*(q1^2 + q2^2 + q3^2 + q4^2)^2), (2*(conj(x)^2 - 2*conj(y)*conj(yf) - 2*conj(z)*conj(zf) - 2*conj(x)*conj(xf) + conj(xf)^2 + conj(y)^2 + conj(yf)^2 + conj(z)^2 + conj(zf)^2)*(q4^3*conj(x) - q4^3*conj(xf) + q1^3*conj(y) - q1^3*conj(yf) + q1^2*q4*conj(x) - q2^2*q4*conj(x) + q3^2*q4*conj(x) - q1^2*q4*conj(xf) + q2^2*q4*conj(xf) - q3^2*q4*conj(xf) - q1*q2^2*conj(y) + q1*q3^2*conj(y) + q1*q4^2*conj(y) + q1*q2^2*conj(yf) - q1*q3^2*conj(yf) - q1*q4^2*conj(yf) - 2*q1^2*q2*conj(z) - 2*q2*q4^2*conj(z) + 2*q1^2*q2*conj(zf) + 2*q2*q4^2*conj(zf) + 2*q1*q2*q3*conj(x) - 2*q1*q2*q3*conj(xf) - 2*q2*q3*q4*conj(y) + 2*q2*q3*q4*conj(yf)))/(((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(3/2)*((((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2) + 1)*(q1^2 + q2^2 + q3^2 + q4^2)^2), -(2*(conj(x)^2 - 2*conj(y)*conj(yf) - 2*conj(z)*conj(zf) - 2*conj(x)*conj(xf) + conj(xf)^2 + conj(y)^2 + conj(yf)^2 + conj(z)^2 + conj(zf)^2)*(q1^3*conj(x) - q1^3*conj(xf) - q4^3*conj(y) + q4^3*conj(yf) + q1*q2^2*conj(x) - q1*q3^2*conj(x) + q1*q4^2*conj(x) - q1*q2^2*conj(xf) + q1*q3^2*conj(xf) - q1*q4^2*conj(xf) - q1^2*q4*conj(y) - q2^2*q4*conj(y) + q3^2*q4*conj(y) + q1^2*q4*conj(yf) + q2^2*q4*conj(yf) - q3^2*q4*conj(yf) + 2*q1^2*q3*conj(z) + 2*q3*q4^2*conj(z) - 2*q1^2*q3*conj(zf) - 2*q3*q4^2*conj(zf) + 2*q2*q3*q4*conj(x) - 2*q2*q3*q4*conj(xf) + 2*q1*q2*q3*conj(y) - 2*q1*q2*q3*conj(yf)))/(((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(3/2)*((((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2) + 1)*(q1^2 + q2^2 + q3^2 + q4^2)^2), (2*(conj(x)^2 - 2*conj(y)*conj(yf) - 2*conj(z)*conj(zf) - 2*conj(x)*conj(xf) + conj(xf)^2 + conj(y)^2 + conj(yf)^2 + conj(z)^2 + conj(zf)^2)*(q2^3*conj(x) - q2^3*conj(xf) + q3^3*conj(y) - q3^3*conj(yf) + q1^2*q2*conj(x) + q2*q3^2*conj(x) - q2*q4^2*conj(x) - q1^2*q2*conj(xf) - q2*q3^2*conj(xf) + q2*q4^2*conj(xf) + q1^2*q3*conj(y) + q2^2*q3*conj(y) - q3*q4^2*conj(y) - q1^2*q3*conj(yf) - q2^2*q3*conj(yf) + q3*q4^2*conj(yf) + 2*q2^2*q4*conj(z) + 2*q3^2*q4*conj(z) - 2*q2^2*q4*conj(zf) - 2*q3^2*q4*conj(zf) + 2*q1*q3*q4*conj(x) - 2*q1*q3*q4*conj(xf) - 2*q1*q2*q4*conj(y) + 2*q1*q2*q4*conj(yf)))/(((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(3/2)*((((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2) + 1)*(q1^2 + q2^2 + q3^2 + q4^2)^2), 0, 0, 0, 0, 0, 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (conj(x) - conj(xf))/(conj(x)^2 - 2*conj(x)*conj(xf) + conj(xf)^2 + conj(y)^2 - 2*conj(y)*conj(yf) + conj(yf)^2 + conj(z)^2 - 2*conj(z)*conj(zf) + conj(zf)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (conj(y) - conj(yf))/(conj(x)^2 - 2*conj(x)*conj(xf) + conj(xf)^2 + conj(y)^2 - 2*conj(y)*conj(yf) + conj(yf)^2 + conj(z)^2 - 2*conj(z)*conj(zf) + conj(zf)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (conj(z) - conj(zf))/(conj(x)^2 - 2*conj(x)*conj(xf) + conj(xf)^2 + conj(y)^2 - 2*conj(y)*conj(yf) + conj(yf)^2 + conj(z)^2 - 2*conj(z)*conj(zf) + conj(zf)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0, 0, 0, 0, 0, 0, 0];


 
H(:,fpos:fpos+2) = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ((q1^2 + q2^2 + q3^2 + q4^2)*(q1^2*conj(y) - q2^2*conj(y) - q3^2*conj(y) + q4^2*conj(y) - q1^2*conj(yf) + q2^2*conj(yf) + q3^2*conj(yf) - q4^2*conj(yf) - 2*q1*q2*conj(z) - 2*q3*q4*conj(z) + 2*q1*q2*conj(zf) + 2*q3*q4*conj(zf)))/(((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + 1)*(q1^2*conj(x) + q2^2*conj(x) - q3^2*conj(x) - q4^2*conj(x) - q1^2*conj(xf) - q2^2*conj(xf) + q3^2*conj(xf) + q4^2*conj(xf) - 2*q1*q4*conj(y) + 2*q2*q3*conj(y) + 2*q1*q4*conj(yf) - 2*q2*q3*conj(yf) + 2*q1*q3*conj(z) + 2*q2*q4*conj(z) - 2*q1*q3*conj(zf) - 2*q2*q4*conj(zf))^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               -((q1^2 + q2^2 + q3^2 + q4^2)*(q1^2*conj(x) - q2^2*conj(x) - q3^2*conj(x) + q4^2*conj(x) - q1^2*conj(xf) + q2^2*conj(xf) + q3^2*conj(xf) - q4^2*conj(xf) + 2*q1*q3*conj(z) - 2*q2*q4*conj(z) - 2*q1*q3*conj(zf) + 2*q2*q4*conj(zf)))/(((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + 1)*(q1^2*conj(x) + q2^2*conj(x) - q3^2*conj(x) - q4^2*conj(x) - q1^2*conj(xf) - q2^2*conj(xf) + q3^2*conj(xf) + q4^2*conj(xf) - 2*q1*q4*conj(y) + 2*q2*q3*conj(y) + 2*q1*q4*conj(yf) - 2*q2*q3*conj(yf) + 2*q1*q3*conj(z) + 2*q2*q4*conj(z) - 2*q1*q3*conj(zf) - 2*q2*q4*conj(zf))^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           (2*(q1^2 + q2^2 + q3^2 + q4^2)*(q1*q2*conj(x) + q3*q4*conj(x) - q1*q2*conj(xf) - q3*q4*conj(xf) + q1*q3*conj(y) - q2*q4*conj(y) - q1*q3*conj(yf) + q2*q4*conj(yf)))/(((((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + 1)*(q1^2*conj(x) + q2^2*conj(x) - q3^2*conj(x) - q4^2*conj(x) - q1^2*conj(xf) - q2^2*conj(xf) + q3^2*conj(xf) + q4^2*conj(xf) - 2*q1*q4*conj(y) + 2*q2*q3*conj(y) + 2*q1*q4*conj(yf) - 2*q2*q3*conj(yf) + 2*q1*q3*conj(z) + 2*q2*q4*conj(z) - 2*q1*q3*conj(zf) - 2*q2*q4*conj(zf))^2);
                              ((((4*(q1*q4 + q2*q3)*(((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2))*(((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(2*((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(3/2)) + (2*(q1*q3 - q2*q4))/(((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(1/2)*(q1^2 + q2^2 + q3^2 + q4^2)))/((((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2) + 1), -((((4*(q1*q4 - q2*q3)*(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2))*(((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(2*((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(3/2)) + (2*(q1*q2 + q3*q4))/(((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(1/2)*(q1^2 + q2^2 + q3^2 + q4^2)))/((((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2) + 1), ((((4*(q1*q3 + q2*q4)*(((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(q1^2 + q2^2 + q3^2 + q4^2) - (4*(q1*q2 - q3*q4)*(((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(q1^2 + q2^2 + q3^2 + q4^2))*(((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2)))/(2*((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(3/2)) - (q1^2 - q2^2 - q3^2 + q4^2)/(((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2)^(1/2)*(q1^2 + q2^2 + q3^2 + q4^2)))/((((conj(z) - conj(zf))*(q1^2 - q2^2 - q3^2 + q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(x) - conj(xf))*(q1*q3 - q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(y) - conj(yf))*(q1*q2 + q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2/((((conj(x) - conj(xf))*(q1^2 + q2^2 - q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(y) - conj(yf))*(q1*q4 - q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(z) - conj(zf))*(q1*q3 + q2*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2 + (((conj(y) - conj(yf))*(q1^2 - q2^2 + q3^2 - q4^2))/(q1^2 + q2^2 + q3^2 + q4^2) + (2*(conj(x) - conj(xf))*(q1*q4 + q2*q3))/(q1^2 + q2^2 + q3^2 + q4^2) - (2*(conj(z) - conj(zf))*(q1*q2 - q3*q4))/(q1^2 + q2^2 + q3^2 + q4^2))^2) + 1);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     -(conj(x) - conj(xf))/(conj(x)^2 - 2*conj(x)*conj(xf) + conj(xf)^2 + conj(y)^2 - 2*conj(y)*conj(yf) + conj(yf)^2 + conj(z)^2 - 2*conj(z)*conj(zf) + conj(zf)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          -(conj(y) - conj(yf))/(conj(x)^2 - 2*conj(x)*conj(xf) + conj(xf)^2 + conj(y)^2 - 2*conj(y)*conj(yf) + conj(yf)^2 + conj(z)^2 - 2*conj(z)*conj(zf) + conj(zf)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     -(conj(z) - conj(zf))/(conj(x)^2 - 2*conj(x)*conj(xf) + conj(xf)^2 + conj(y)^2 - 2*conj(y)*conj(yf) + conj(yf)^2 + conj(z)^2 - 2*conj(z)*conj(zf) + conj(zf)^2)^(1/2)];

                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
